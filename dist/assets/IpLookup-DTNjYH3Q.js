import{r as s,c as a,k as e,l,m as t,n as r,C as o,D as n,t as i,F as c,q as u,j as v,u as d}from"./vendor-Cf-Dxv3i.js";import{s as p,G as g}from"./ui-D-c3Ifvx.js";const m=new class{constructor(){this.queue=[],this.active=0,this.maxConcurrent=2,this.timeout=1e4}async request(s,a={}){return new Promise((e,l)=>{const t={...a,signal:AbortSignal.timeout(this.timeout),priority:"low"};this.queue.push({url:s,options:t,resolve:e,reject:l,timestamp:Date.now()}),this.process()})}async process(){if(this.active>=this.maxConcurrent||0===this.queue.length)return;this.active++;const{url:s,options:a,resolve:e,reject:l}=this.queue.shift();try{const l=await fetch(s,a);if(!l.ok)throw new Error(`HTTP ${l.status}: ${l.statusText}`);e(l)}catch(t){l(t)}finally{this.active--,this.process()}}cleanup(){const s=Date.now();this.queue=this.queue.filter(a=>s-a.timestamp<3e4)}};setInterval(()=>{m.cleanup()},6e4);const y=(s,a={})=>m.request(s,a),x={class:"space-y-6"},h={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},b={class:"space-y-4"},f={class:"space-y-3"},w={class:"flex space-x-2"},k=["disabled"],I=["disabled"],P={key:0,class:"space-y-3"},$={class:"space-y-2"},C=["onClick"],q={class:"space-y-4"},j={key:0,class:"space-y-4"},S={class:"bg-white border border-gray-200 rounded-lg p-4"},T={class:"grid grid-cols-2 gap-3 text-sm"},_={class:"ml-2 font-mono"},D={class:"ml-2"},N={class:"ml-2"},A={class:"ml-2 font-mono"},E={class:"bg-white border border-gray-200 rounded-lg p-4"},J={class:"grid grid-cols-2 gap-3 text-sm"},O={class:"ml-2"},U={class:"ml-2"},z={class:"ml-2"},F={class:"ml-2"},G={class:"col-span-2"},H={class:"ml-2 font-mono"},L={class:"bg-white border border-gray-200 rounded-lg p-4"},V={class:"grid grid-cols-2 gap-3 text-sm"},B={class:"ml-2"},K={class:"ml-2 font-mono"},M={class:"ml-2"},Q={class:"ml-2"},R={class:"flex space-x-2"},W=["disabled"],X={key:1,class:"bg-red-50 border border-red-200 rounded-lg p-4"},Y={class:"flex items-center"},Z={class:"text-red-700"},ss={key:2,class:"bg-gray-50 border border-gray-200 rounded-lg p-8 text-center"},as={__name:"IpLookup",setup(m){const as=s(""),es=s(null),ls=s(""),ts=s(!1),rs=s([]),os=a(()=>/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(as.value)),ns=async()=>{ts.value=!0,ls.value="";try{const s=await y("https://api.ipify.org?format=json"),a=await s.json();as.value=a.ip}catch(s){ls.value="获取本机 IP 失败"}finally{ts.value=!1}},is=async()=>{if(os.value){ts.value=!0,ls.value="",es.value=null;try{const s=await y(`https://ipapi.co/${as.value}/json/`),a=await s.json();if(a.error)throw new Error(a.reason||"查询失败");es.value=a,cs({ip:as.value,location:`${a.city||""} ${a.region||""} ${a.country||""}`.trim()})}catch(s){ls.value=s.message||"查询 IP 信息失败"}finally{ts.value=!1}}},cs=s=>{rs.value=rs.value.filter(a=>a.ip!==s.ip),rs.value.unshift(s),rs.value.length>10&&(rs.value=rs.value.slice(0,10)),localStorage.setItem("ip-lookup-history",JSON.stringify(rs.value))},us=()=>{rs.value=[],localStorage.removeItem("ip-lookup-history")},vs=()=>{if(!es.value)return;const s=`IP: ${es.value.ip}\n国家: ${es.value.country||"未知"}\n地区: ${es.value.region||"未知"}\n城市: ${es.value.city||"未知"}\nISP: ${es.value.org||"未知"}\n坐标: ${es.value.loc||"未知"}`;navigator.clipboard.writeText(s).then(()=>{alert("IP 信息已复制到剪贴板")}).catch(()=>{alert("复制失败")})},ds=()=>{var s;if(!(null==(s=es.value)?void 0:s.loc))return;const[a,e]=es.value.loc.split(","),l=`https://www.google.com/maps?q=${a},${e}`;window.open(l,"_blank")};return(()=>{try{const s=localStorage.getItem("ip-lookup-history");s&&(rs.value=JSON.parse(s))}catch(s){}})(),(s,a)=>(l(),e("div",x,[t("div",h,[t("div",b,[a[3]||(a[3]=t("h3",{class:"text-lg font-semibold text-gray-900"},"IP 地址查询",-1)),t("div",f,[a[1]||(a[1]=t("label",{class:"block text-sm font-medium text-gray-700"},"IP 地址",-1)),t("div",w,[o(t("input",{"onUpdate:modelValue":a[0]||(a[0]=s=>as.value=s),type:"text",placeholder:"输入 IP 地址，如: 8.8.8.8",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,512),[[n,as.value]]),t("button",{onClick:ns,disabled:ts.value,class:"btn-secondary whitespace-nowrap"},i(ts.value?"查询中...":"我的IP"),9,k)])]),t("button",{onClick:is,disabled:!os.value||ts.value,class:"btn-primary w-full"},i(ts.value?"查询中...":"查询 IP 信息"),9,I),rs.value.length>0?(l(),e("div",P,[a[2]||(a[2]=t("h4",{class:"font-medium text-gray-900"},"查询历史",-1)),t("div",$,[(l(!0),e(c,null,u(rs.value.slice(0,5),(s,a)=>(l(),e("button",{key:a,onClick:a=>(s=>{as.value=s.ip})(s),class:"w-full text-left px-3 py-2 bg-gray-50 hover:bg-gray-100 rounded-md text-sm text-gray-700 transition-colors"},i(s.ip)+" - "+i(s.location||"未知位置"),9,C))),128))]),t("button",{onClick:us,class:"text-sm text-red-600 hover:text-red-700"}," 清空历史 ")])):r("",!0)]),t("div",q,[a[21]||(a[21]=t("h3",{class:"text-lg font-semibold text-gray-900"},"查询结果",-1)),es.value?(l(),e("div",j,[t("div",S,[a[8]||(a[8]=t("h4",{class:"font-medium text-gray-900 mb-3"},"基本信息",-1)),t("div",T,[t("div",null,[a[4]||(a[4]=t("span",{class:"text-gray-500"},"IP 地址:",-1)),t("span",_,i(es.value.ip),1)]),t("div",null,[a[5]||(a[5]=t("span",{class:"text-gray-500"},"类型:",-1)),t("span",D,i(es.value.type||"未知"),1)]),t("div",null,[a[6]||(a[6]=t("span",{class:"text-gray-500"},"版本:",-1)),t("span",N,i(es.value.version||"未知"),1)]),t("div",null,[a[7]||(a[7]=t("span",{class:"text-gray-500"},"主机名:",-1)),t("span",A,i(es.value.hostname||"无"),1)])])]),t("div",E,[a[14]||(a[14]=t("h4",{class:"font-medium text-gray-900 mb-3"},"地理位置",-1)),t("div",J,[t("div",null,[a[9]||(a[9]=t("span",{class:"text-gray-500"},"国家:",-1)),t("span",O,i(es.value.country||"未知"),1)]),t("div",null,[a[10]||(a[10]=t("span",{class:"text-gray-500"},"地区:",-1)),t("span",U,i(es.value.region||"未知"),1)]),t("div",null,[a[11]||(a[11]=t("span",{class:"text-gray-500"},"城市:",-1)),t("span",z,i(es.value.city||"未知"),1)]),t("div",null,[a[12]||(a[12]=t("span",{class:"text-gray-500"},"邮编:",-1)),t("span",F,i(es.value.postal||"未知"),1)]),t("div",G,[a[13]||(a[13]=t("span",{class:"text-gray-500"},"坐标:",-1)),t("span",H,i(es.value.loc||"未知"),1)])])]),t("div",L,[a[19]||(a[19]=t("h4",{class:"font-medium text-gray-900 mb-3"},"网络信息",-1)),t("div",V,[t("div",null,[a[15]||(a[15]=t("span",{class:"text-gray-500"},"ISP:",-1)),t("span",B,i(es.value.org||"未知"),1)]),t("div",null,[a[16]||(a[16]=t("span",{class:"text-gray-500"},"ASN:",-1)),t("span",K,i(es.value.asn||"未知"),1)]),t("div",null,[a[17]||(a[17]=t("span",{class:"text-gray-500"},"时区:",-1)),t("span",M,i(es.value.timezone||"未知"),1)]),t("div",null,[a[18]||(a[18]=t("span",{class:"text-gray-500"},"UTC:",-1)),t("span",Q,i(es.value.utc_offset||"未知"),1)])])]),t("div",R,[t("button",{onClick:vs,class:"btn-secondary flex-1"}," 复制信息 "),t("button",{onClick:ds,disabled:!es.value.loc,class:"btn-primary flex-1"}," 在地图上查看 ",8,W)])])):ls.value?(l(),e("div",X,[t("div",Y,[v(d(p),{class:"w-5 h-5 text-red-500 mr-2"}),t("span",Z,i(ls.value),1)])])):(l(),e("div",ss,[v(d(g),{class:"w-16 h-16 text-gray-300 mx-auto mb-4"}),a[20]||(a[20]=t("p",{class:"text-gray-500"},"输入 IP 地址开始查询",-1))]))])])]))}};export{as as default};
